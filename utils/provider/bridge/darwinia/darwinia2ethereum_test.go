package darwinia

import (
	"github.com/ethereum/go-ethereum/common"
	"github.com/shopspring/decimal"
	"github.com/stretchr/testify/assert"
	"omni-balance/utils"
	"omni-balance/utils/chains"
	"testing"
)

func TestDarwinia2ethereum(t *testing.T) {
	var (
		args   = InitVar(t)
		amount = decimal.NewFromBigInt(chains.EthToWei(decimal.RequireFromString("0")), 0)
	)
	tx, err := Darwinia2ethereum(args.ctx, SwapParams{
		Sender:    args.sender,
		TokenName: "RING",
		Amount:    amount,
		Nonce:     1716966337913,
		Client:    args.client,
	})
	assert.NoError(t, err)
	utils.AssertEqualFold(t, common.Bytes2Hex(tx.Data), "7104aad500000000000000000000000000000000000000000000000000000000000000010000000000000000000000004ca75992d2750bec270731a72dfdede6b9e71cc700000000000000000000000043ef13e84d9992d1461a1f90cac4653658cea4fd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018fc32b2d7900000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000080000000000000000000000000c29dcb1f12a1618262ef9fba673b77140adc02d60000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000001443ef13e84d9992d1461a1f90cac4653658cea4fd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000016fe400000000000000000000000043ef13e84d9992d1461a1f90cac4653658cea4fd00000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000")
	assert.Equal(t, tx.To.Hex(), "0x092e19C46C9daAb7824393f1CD9c22f5BEA13560")

	tx, err = Darwinia2ethereum(args.ctx, SwapParams{
		Sender:    args.sender,
		TokenName: "KTON",
		Amount:    amount,
		Nonce:     1716966513487,
		Client:    args.client,
	})
	assert.NoError(t, err)
	utils.AssertEqualFold(t, common.Bytes2Hex(tx.Data), "ac66b6a2000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000004020000000000000000000000004ca75992d2750bec270731a72dfdede6b9e71cc700000000000000000000000043ef13e84d9992d1461a1f90cac4653658cea4fd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018fc32ddb4f00000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000006000000000000000000000000043ef13e84d9992d1461a1f90cac4653658cea4fd0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000016c0400000000000000000000000043ef13e84d9992d1461a1f90cac4653658cea4fd00000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000")
	assert.Equal(t, tx.To.Hex(), "0x2B496f19A420C02490dB859fefeCCD71eDc2c046")
}
