package uniswap

import (
	"context"
	"encoding/json"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/ethclient"
	"github.com/shopspring/decimal"
	"github.com/stretchr/testify/assert"
	"math/big"
	"omni-balance/utils/configs"
	"omni-balance/utils/constant"
	"omni-balance/utils/provider/dex/uniswap/utils"
	"omni-balance/utils/wallets"
	"testing"
)

var conf = &configs.Config{
	Wallets: []configs.Wallet{
		{
			Address:    constant.TestWalletAddress,
			PrivateKey: constant.TestPrivateKey,
		},
	},
	Chains: []configs.Chain{
		{
			Name: "arbitrum",
			RpcEndpoints: []string{
				"https://arb1.arbitrum.io/rpc",
			},
			Tokens: []configs.Token{
				{
					Name:            "CBETH",
					ContractAddress: "0x1debd73e752beaf79865fd6446b0c970eae7732f",
					Decimals:        18,
				},
				{
					Name:            "ETH",
					ContractAddress: constant.ZeroAddress.Hex(),
					Decimals:        18,
				},
				{
					Name:            "RING",
					ContractAddress: "0x9e523234D36973f9e38642886197D023C88e307e", // gitleaks:allow
					Decimals:        18,
				},
			},
			Id: 42161,
		},
	},
}

func TestUniswap_BuildTx(t *testing.T) {
	conf.Init()
	client, err := ethclient.Dial("https://arb1.arbitrum.io/rpc")
	assert.NoError(t, err)
	quoteData := `{"routing":"CLASSIC","quote":{"methodParameters":{"calldata":"0x24856bc30000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000050b0105040c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002a00000000000000000000000000000000000000000000000000000000000000320000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000147f6101f37d00000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000001163fe8c5429500000000000000000000000000000000000000000000000000000000147f6101f37d00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b9e523234d36973f9e38642886197d023c88e307e000bb882af49447d8a07e3bd95bd0d56f35241523fbab100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000009e523234d36973f9e38642886197d023c88e307e00000000000000000000000089f30783108e2f9191db4a44ae2a516327c9957500000000000000000000000000000000000000000000000000b1a2bc2ec5000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000009e523234d36973f9e38642886197d023c88e307e0000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e000000000000000000000000000000000000000000000001158e460913d0000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e0000000000000000000000000000000000000000000000000000000000000000","value":"0x147f6101f37d","to":"0x5E325eDA8064b456f4781070C0738d849c824258"},"blockNumber":"213741025","amount":"20000000000000000000","amountDecimals":"20","quote":"22369271765793","quoteDecimals":"0.000022369271765793","quoteGasAdjusted":"24373216442145","quoteGasAdjustedDecimals":"0.000024373216442145","quoteGasAndPortionAdjusted":"24429139621559","quoteGasAndPortionAdjustedDecimals":"0.000024429139621559","gasUseEstimateQuote":"2003944676352","gasUseEstimateQuoteDecimals":"0.000002003944676352","gasUseEstimate":"200394","gasUseEstimateUSD":"0.007619574833510388","simulationStatus":"UNATTEMPTED","simulationError":false,"gasPriceWei":"10000000","route":[[{"type":"v3-pool","address":"0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4","tokenIn":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x9e523234D36973f9e38642886197D023C88e307e","symbol":"RING"},"fee":"3000","liquidity":"83079614297215821019731","sqrtRatioX96":"75027613904587995298968008794024","tickCurrent":"137072","amountIn":"22698953047059","amountOut":"20050000000000000000"}]],"routeString":"[V3] 100.00% = WETH -- 0.3% [0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4] --> RING","quoteId":"9e9ffbfc-e8c0-476b-a39a-6c87d4e3b199","hitsCachedRoutes":true,"portionBips":25,"portionRecipient":"0x89F30783108E2F9191Db4A44aE2A516327C99575","portionAmount":"50000000000000000","portionAmountDecimals":"0.05","requestId":"8541333c-2b0f-41a0-8cf9-6b1182b9a824","permitData":{"domain":{"name":"Permit2","chainId":42161,"verifyingContract":"0x000000000022D473030F116dDEE9F6B43aC78BA3"},"types":{"PermitSingle":[{"name":"details","type":"PermitDetails"},{"name":"spender","type":"address"},{"name":"sigDeadline","type":"uint256"}],"PermitDetails":[{"name":"token","type":"address"},{"name":"amount","type":"uint160"},{"name":"expiration","type":"uint48"},{"name":"nonce","type":"uint48"}]},"values":{"details":{"token":"0x0000000000000000000000000000000000000000","amount":"1461501637330902918203684832716283019655932542975","expiration":"1718940656","nonce":"0"},"spender":"0x5E325eDA8064b456f4781070C0738d849c824258","sigDeadline":"1716350456"}},"tradeType":"EXACT_OUTPUT","slippage":0.5},"requestId":"8541333c-2b0f-41a0-8cf9-6b1182b9a824","allQuotes":[{"routing":"CLASSIC","quote":{"methodParameters":{"calldata":"0x24856bc30000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000050b0105040c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002a00000000000000000000000000000000000000000000000000000000000000320000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000147f6101f37d00000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000001163fe8c5429500000000000000000000000000000000000000000000000000000000147f6101f37d00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b9e523234d36973f9e38642886197d023c88e307e000bb882af49447d8a07e3bd95bd0d56f35241523fbab100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000009e523234d36973f9e38642886197d023c88e307e00000000000000000000000089f30783108e2f9191db4a44ae2a516327c9957500000000000000000000000000000000000000000000000000b1a2bc2ec5000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000009e523234d36973f9e38642886197d023c88e307e0000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e000000000000000000000000000000000000000000000001158e460913d0000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e0000000000000000000000000000000000000000000000000000000000000000","value":"0x147f6101f37d","to":"0x5E325eDA8064b456f4781070C0738d849c824258"},"blockNumber":"213741025","amount":"20000000000000000000","amountDecimals":"20","quote":"22369271765793","quoteDecimals":"0.000022369271765793","quoteGasAdjusted":"24373216442145","quoteGasAdjustedDecimals":"0.000024373216442145","quoteGasAndPortionAdjusted":"24429139621559","quoteGasAndPortionAdjustedDecimals":"0.000024429139621559","gasUseEstimateQuote":"2003944676352","gasUseEstimateQuoteDecimals":"0.000002003944676352","gasUseEstimate":"200394","gasUseEstimateUSD":"0.007619574833510388","simulationStatus":"UNATTEMPTED","simulationError":false,"gasPriceWei":"10000000","route":[[{"type":"v3-pool","address":"0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4","tokenIn":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x9e523234D36973f9e38642886197D023C88e307e","symbol":"RING"},"fee":"3000","liquidity":"83079614297215821019731","sqrtRatioX96":"75027613904587995298968008794024","tickCurrent":"137072","amountIn":"22698953047059","amountOut":"20050000000000000000"}]],"routeString":"[V3] 100.00% = WETH -- 0.3% [0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4] --> RING","quoteId":"9e9ffbfc-e8c0-476b-a39a-6c87d4e3b199","hitsCachedRoutes":true,"portionBips":25,"portionRecipient":"0x89F30783108E2F9191Db4A44aE2A516327C99575","portionAmount":"50000000000000000","portionAmountDecimals":"0.05","requestId":"8541333c-2b0f-41a0-8cf9-6b1182b9a824","permitData":{"domain":{"name":"Permit2","chainId":42161,"verifyingContract":"0x000000000022D473030F116dDEE9F6B43aC78BA3"},"types":{"PermitSingle":[{"name":"details","type":"PermitDetails"},{"name":"spender","type":"address"},{"name":"sigDeadline","type":"uint256"}],"PermitDetails":[{"name":"token","type":"address"},{"name":"amount","type":"uint160"},{"name":"expiration","type":"uint48"},{"name":"nonce","type":"uint48"}]},"values":{"details":{"token":"0x0000000000000000000000000000000000000000","amount":"1461501637330902918203684832716283019655932542975","expiration":"1718940656","nonce":"0"},"spender":"0x5E325eDA8064b456f4781070C0738d849c824258","sigDeadline":"1716350456"}},"tradeType":"EXACT_OUTPUT","slippage":0.5}}]}`                                                                                                                                                                                                                                                                                                                                        // gitleaks:allow
	cbETHquoteData := `{"routing":"CLASSIC","quote":{"methodParameters":{"calldata":"0x24856bc300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000301050400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000123c4120b4000000000000000000000000000000000000000000000000010eb8b5647007d4b600000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000421debd73e752beaf79865fd6446b0c970eae7732f000bb882af49447d8a07e3bd95bd0d56f35241523fbab1000bb89e523234d36973f9e38642886197d023c88e307e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f00000000000000000000000089f30783108e2f9191db4a44ae2a516327c995750000000000000000000000000000000000000000000000000000000ba43b740000000000000000000000000000000000000000000000000000000000000000600000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f0000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e000000000000000000000000000000000000000000000000000012309ce54000","value":"0x00","to":"0x5E325eDA8064b456f4781070C0738d849c824258"},"blockNumber":"213813900","amount":"20000000000000","amountDecimals":"0.00002","quote":"19362083576070988577","quoteDecimals":"19.362083576070988577","quoteGasAdjusted":"21852250560150417637","quoteGasAdjustedDecimals":"21.852250560150417637","quoteGasAndPortionAdjusted":"21900655769090595108","quoteGasAndPortionAdjustedDecimals":"21.900655769090595108","gasUseEstimateQuote":"2490166984079429060","gasUseEstimateQuoteDecimals":"2.49016698407942906","gasUseEstimate":"276278","gasUseEstimateUSD":"0.010405816029298318","simulationStatus":"UNATTEMPTED","simulationError":false,"gasPriceWei":"10000000","route":[[{"type":"v3-pool","address":"0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4","tokenIn":{"chainId":42161,"decimals":"18","address":"0x9e523234D36973f9e38642886197D023C88e307e","symbol":"RING"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"fee":"3000","liquidity":"83079614297215821019731","sqrtRatioX96":"75217739790961806731360142688900","tickCurrent":"137123","amountIn":"19507541228936221878"},{"type":"v3-pool","address":"0xEd3fE08bd12F24dad0f1a1E58610644dEbe374fb","tokenIn":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","symbol":"cbETH"},"fee":"3000","liquidity":"3544355497631728858561","sqrtRatioX96":"81864391755545008004895065536","tickCurrent":"654","amountOut":"20050000000000"}]],"routeString":"[V3] 100.00% = RING -- 0.3% [0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4] --> WETH -- 0.3% [0xEd3fE08bd12F24dad0f1a1E58610644dEbe374fb] --> cbETH","quoteId":"bd03db72-4b74-4cae-a39d-23aaa911c28f","hitsCachedRoutes":true,"portionBips":25,"portionRecipient":"0x89F30783108E2F9191Db4A44aE2A516327C99575","portionAmount":"50000000000","portionAmountDecimals":"0.00000005","requestId":"0fc33eb1-f91f-49dd-8968-9db0225639c0","tradeType":"EXACT_OUTPUT","slippage":0.5},"requestId":"0fc33eb1-f91f-49dd-8968-9db0225639c0","allQuotes":[{"routing":"CLASSIC","quote":{"methodParameters":{"calldata":"0x24856bc300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000301050400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000123c4120b4000000000000000000000000000000000000000000000000010eb8b5647007d4b600000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000421debd73e752beaf79865fd6446b0c970eae7732f000bb882af49447d8a07e3bd95bd0d56f35241523fbab1000bb89e523234d36973f9e38642886197d023c88e307e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f00000000000000000000000089f30783108e2f9191db4a44ae2a516327c995750000000000000000000000000000000000000000000000000000000ba43b740000000000000000000000000000000000000000000000000000000000000000600000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f0000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e000000000000000000000000000000000000000000000000000012309ce54000","value":"0x00","to":"0x5E325eDA8064b456f4781070C0738d849c824258"},"blockNumber":"213813900","amount":"20000000000000","amountDecimals":"0.00002","quote":"19362083576070988577","quoteDecimals":"19.362083576070988577","quoteGasAdjusted":"21852250560150417637","quoteGasAdjustedDecimals":"21.852250560150417637","quoteGasAndPortionAdjusted":"21900655769090595108","quoteGasAndPortionAdjustedDecimals":"21.900655769090595108","gasUseEstimateQuote":"2490166984079429060","gasUseEstimateQuoteDecimals":"2.49016698407942906","gasUseEstimate":"276278","gasUseEstimateUSD":"0.010405816029298318","simulationStatus":"UNATTEMPTED","simulationError":false,"gasPriceWei":"10000000","route":[[{"type":"v3-pool","address":"0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4","tokenIn":{"chainId":42161,"decimals":"18","address":"0x9e523234D36973f9e38642886197D023C88e307e","symbol":"RING"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"fee":"3000","liquidity":"83079614297215821019731","sqrtRatioX96":"75217739790961806731360142688900","tickCurrent":"137123","amountIn":"19410488785011166048"},{"type":"v3-pool","address":"0xEd3fE08bd12F24dad0f1a1E58610644dEbe374fb","tokenIn":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","symbol":"cbETH"},"fee":"3000","liquidity":"3544355497631728858561","sqrtRatioX96":"81864391755545008004895065536","tickCurrent":"654","amountOut":"20050000000000"}]],"routeString":"[V3] 100.00% = RING -- 0.3% [0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4] --> WETH -- 0.3% [0xEd3fE08bd12F24dad0f1a1E58610644dEbe374fb] --> cbETH","quoteId":"bd03db72-4b74-4cae-a39d-23aaa911c28f","hitsCachedRoutes":true,"portionBips":25,"portionRecipient":"0x89F30783108E2F9191Db4A44aE2A516327C99575","portionAmount":"50000000000","portionAmountDecimals":"0.00000005","requestId":"0fc33eb1-f91f-49dd-8968-9db0225639c0","tradeType":"EXACT_OUTPUT","slippage":0.5}}]}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 // gitleaks:allow
	RING2ETHquoteData := `{"routing":"CLASSIC","quote":{"methodParameters":{"calldata":"0x24856bc300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000301050c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000123c4120b400000000000000000000000000000000000000000000000000fcce4826bed4f5a700000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002b82af49447d8a07e3bd95bd0d56f35241523fbab1000bb89e523234d36973f9e38642886197d023c88e307e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000082af49447d8a07e3bd95bd0d56f35241523fbab100000000000000000000000089f30783108e2f9191db4a44ae2a516327c995750000000000000000000000000000000000000000000000000000000ba43b740000000000000000000000000000000000000000000000000000000000000000400000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e000000000000000000000000000000000000000000000000000012309ce54000","value":"0x00","to":"0x5E325eDA8064b456f4781070C0738d849c824258"},"blockNumber":"213817191","amount":"20000000000000","amountDecimals":"0.00002","quote":"18080745275128417452","quoteDecimals":"18.080745275128417452","quoteGasAdjusted":"19899248096074758680","quoteGasAdjustedDecimals":"19.89924809607475868","quoteGasAndPortionAdjusted":"19944449959262579723","quoteGasAndPortionAdjustedDecimals":"19.944449959262579723","gasUseEstimateQuote":"1818502820946341228","gasUseEstimateQuoteDecimals":"1.818502820946341228","gasUseEstimate":"201758","gasUseEstimateUSD":"0.007599069507237653","simulationStatus":"UNATTEMPTED","simulationError":false,"gasPriceWei":"10000000","route":[[{"type":"v3-pool","address":"0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4","tokenIn":{"chainId":42161,"decimals":"18","address":"0x9e523234D36973f9e38642886197D023C88e307e","symbol":"RING"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"fee":"3000","liquidity":"83079614297215821019731","sqrtRatioX96":"75217739790961806731360142688900","tickCurrent":"137123","amountIn":"18216576874007819687","amountOut":"20050000000000"}]],"routeString":"[V3] 100.00% = RING -- 0.3% [0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4] --> WETH","quoteId":"235fc981-0c21-4b72-b6cf-503e5a5f9f75","hitsCachedRoutes":true,"portionBips":25,"portionRecipient":"0x89F30783108E2F9191Db4A44aE2A516327C99575","portionAmount":"50000000000","portionAmountDecimals":"0.00000005","requestId":"2db07bc8-ad9b-48b4-83d9-d516cc37beab","tradeType":"EXACT_OUTPUT","slippage":0.5},"requestId":"2db07bc8-ad9b-48b4-83d9-d516cc37beab","allQuotes":[{"routing":"CLASSIC","quote":{"methodParameters":{"calldata":"0x24856bc300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000301050c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000123c4120b400000000000000000000000000000000000000000000000000fcce4826bed4f5a700000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002b82af49447d8a07e3bd95bd0d56f35241523fbab1000bb89e523234d36973f9e38642886197d023c88e307e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000082af49447d8a07e3bd95bd0d56f35241523fbab100000000000000000000000089f30783108e2f9191db4a44ae2a516327c995750000000000000000000000000000000000000000000000000000000ba43b740000000000000000000000000000000000000000000000000000000000000000400000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e000000000000000000000000000000000000000000000000000012309ce54000","value":"0x00","to":"0x5E325eDA8064b456f4781070C0738d849c824258"},"blockNumber":"213817191","amount":"20000000000000","amountDecimals":"0.00002","quote":"18080745275128417452","quoteDecimals":"18.080745275128417452","quoteGasAdjusted":"19899248096074758680","quoteGasAdjustedDecimals":"19.89924809607475868","quoteGasAndPortionAdjusted":"19944449959262579723","quoteGasAndPortionAdjustedDecimals":"19.944449959262579723","gasUseEstimateQuote":"1818502820946341228","gasUseEstimateQuoteDecimals":"1.818502820946341228","gasUseEstimate":"201758","gasUseEstimateUSD":"0.007599069507237653","simulationStatus":"UNATTEMPTED","simulationError":false,"gasPriceWei":"10000000","route":[[{"type":"v3-pool","address":"0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4","tokenIn":{"chainId":42161,"decimals":"18","address":"0x9e523234D36973f9e38642886197D023C88e307e","symbol":"RING"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"fee":"3000","liquidity":"83079614297215821019731","sqrtRatioX96":"75217739790961806731360142688900","tickCurrent":"137123","amountIn":"18125947138316238495","amountOut":"20050000000000"}]],"routeString":"[V3] 100.00% = RING -- 0.3% [0x39FE2595FC6dF650877FC24E47e15A2F9da7daa4] --> WETH","quoteId":"235fc981-0c21-4b72-b6cf-503e5a5f9f75","hitsCachedRoutes":true,"portionBips":25,"portionRecipient":"0x89F30783108E2F9191Db4A44aE2A516327C99575","portionAmount":"50000000000","portionAmountDecimals":"0.00000005","requestId":"2db07bc8-ad9b-48b4-83d9-d516cc37beab","tradeType":"EXACT_OUTPUT","slippage":0.5}}]}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // gitleaks:allow
	ETH2CBETHV2quoteData := `{"routing":"CLASSIC","quote":{"methodParameters":{"calldata":"0x24856bc30000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000050b0905040c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000001d9a345f20b00000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000001d2d3501200000000000000000000000000000000000000000000000000000001d9a345f20b00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000082af49447d8a07e3bd95bd0d56f35241523fbab10000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f00000000000000000000000000000000000000000000000000000000000000600000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f00000000000000000000000089f30783108e2f9191db4a44ae2a516327c99575000000000000000000000000000000000000000000000000000000012a05f20000000000000000000000000000000000000000000000000000000000000000600000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f0000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e000000000000000000000000000000000000000000000000000001d1a94a200000000000000000000000000000000000000000000000000000000000000000400000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e0000000000000000000000000000000000000000000000000000000000000000","value":"0x01d9a345f20b","to":"0x5E325eDA8064b456f4781070C0738d849c824258"},"blockNumber":"213830031","amount":"2000000000000","amountDecimals":"0.000002","quote":"2019090384649","quoteDecimals":"0.000002019090384649","quoteGasAdjusted":"3715163744489","quoteGasAdjustedDecimals":"0.000003715163744489","quoteGasAndPortionAdjusted":"3720211470450","quoteGasAndPortionAdjustedDecimals":"0.00000372021147045","gasUseEstimateQuote":"1696073359840","gasUseEstimateQuoteDecimals":"0.00000169607335984","gasUseEstimate":"169607","gasUseEstimateUSD":"0.006349","simulationStatus":"UNATTEMPTED","simulationError":false,"gasPriceWei":"10000000","route":[[{"type":"v2-pool","address":"0x1504CA3De8F90149520fCb08e27eb57F7D6a7DE6","tokenIn":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","symbol":"cbETH"},"reserve0":{"token":{"chainId":42161,"decimals":"18","address":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","symbol":"cbETH"},"quotient":"482571368782833"},"reserve1":{"token":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"quotient":"483698006795751"},"amountIn":"2034258801163","amountOut":"2005000000000"}]],"routeString":"[V2] 100.00% = WETH -- [0x1504CA3De8F90149520fCb08e27eb57F7D6a7DE6] --> cbETH","quoteId":"f3349f21-db00-4d67-8c97-0dedc472630f","hitsCachedRoutes":true,"portionBips":25,"portionRecipient":"0x89F30783108E2F9191Db4A44aE2A516327C99575","portionAmount":"5000000000","portionAmountDecimals":"0.000000005","requestId":"7fd363de-73e5-4f3c-9bcd-71b2bea73563","permitData":{"domain":{"name":"Permit2","chainId":42161,"verifyingContract":"0x000000000022D473030F116dDEE9F6B43aC78BA3"},"types":{"PermitSingle":[{"name":"details","type":"PermitDetails"},{"name":"spender","type":"address"},{"name":"sigDeadline","type":"uint256"}],"PermitDetails":[{"name":"token","type":"address"},{"name":"amount","type":"uint160"},{"name":"expiration","type":"uint48"},{"name":"nonce","type":"uint48"}]},"values":{"details":{"token":"0x0000000000000000000000000000000000000000","amount":"1461501637330902918203684832716283019655932542975","expiration":"1718963315","nonce":"0"},"spender":"0x5E325eDA8064b456f4781070C0738d849c824258","sigDeadline":"1716373115"}},"tradeType":"EXACT_OUTPUT","slippage":0.5},"requestId":"7fd363de-73e5-4f3c-9bcd-71b2bea73563","allQuotes":[{"routing":"CLASSIC","quote":{"methodParameters":{"calldata":"0x24856bc30000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000050b0905040c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000001d9a345f20b00000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000001d2d3501200000000000000000000000000000000000000000000000000000001d9a345f20b00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000082af49447d8a07e3bd95bd0d56f35241523fbab10000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f00000000000000000000000000000000000000000000000000000000000000600000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f00000000000000000000000089f30783108e2f9191db4a44ae2a516327c99575000000000000000000000000000000000000000000000000000000012a05f20000000000000000000000000000000000000000000000000000000000000000600000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f0000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e000000000000000000000000000000000000000000000000000001d1a94a200000000000000000000000000000000000000000000000000000000000000000400000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e0000000000000000000000000000000000000000000000000000000000000000","value":"0x01d9a345f20b","to":"0x5E325eDA8064b456f4781070C0738d849c824258"},"blockNumber":"213830031","amount":"2000000000000","amountDecimals":"0.000002","quote":"2019090384649","quoteDecimals":"0.000002019090384649","quoteGasAdjusted":"3715163744489","quoteGasAdjustedDecimals":"0.000003715163744489","quoteGasAndPortionAdjusted":"3720211470450","quoteGasAndPortionAdjustedDecimals":"0.00000372021147045","gasUseEstimateQuote":"1696073359840","gasUseEstimateQuoteDecimals":"0.00000169607335984","gasUseEstimate":"169607","gasUseEstimateUSD":"0.006349","simulationStatus":"UNATTEMPTED","simulationError":false,"gasPriceWei":"10000000","route":[[{"type":"v2-pool","address":"0x1504CA3De8F90149520fCb08e27eb57F7D6a7DE6","tokenIn":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","symbol":"cbETH"},"reserve0":{"token":{"chainId":42161,"decimals":"18","address":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","symbol":"cbETH"},"quotient":"482571368782833"},"reserve1":{"token":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"quotient":"483698006795751"},"amountIn":"2034258801163","amountOut":"2005000000000"}]],"routeString":"[V2] 100.00% = WETH -- [0x1504CA3De8F90149520fCb08e27eb57F7D6a7DE6] --> cbETH","quoteId":"f3349f21-db00-4d67-8c97-0dedc472630f","hitsCachedRoutes":true,"portionBips":25,"portionRecipient":"0x89F30783108E2F9191Db4A44aE2A516327C99575","portionAmount":"5000000000","portionAmountDecimals":"0.000000005","requestId":"7fd363de-73e5-4f3c-9bcd-71b2bea73563","permitData":{"domain":{"name":"Permit2","chainId":42161,"verifyingContract":"0x000000000022D473030F116dDEE9F6B43aC78BA3"},"types":{"PermitSingle":[{"name":"details","type":"PermitDetails"},{"name":"spender","type":"address"},{"name":"sigDeadline","type":"uint256"}],"PermitDetails":[{"name":"token","type":"address"},{"name":"amount","type":"uint160"},{"name":"expiration","type":"uint48"},{"name":"nonce","type":"uint48"}]},"values":{"details":{"token":"0x0000000000000000000000000000000000000000","amount":"1461501637330902918203684832716283019655932542975","expiration":"1718963315","nonce":"0"},"spender":"0x5E325eDA8064b456f4781070C0738d849c824258","sigDeadline":"1716373115"}},"tradeType":"EXACT_OUTPUT","slippage":0.5}}]}` // gitleaks:allow
	CBETH2ETHV2quoteData := `{"routing":"CLASSIC","quote":{"methodParameters":{"calldata":"0x24856bc300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000309050c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000140f2c578c40000000000000000000000000000000000000000000000000000014f50bb466ca00000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f00000000000000000000000082af49447d8a07e3bd95bd0d56f35241523fbab1000000000000000000000000000000000000000000000000000000000000006000000000000000000000000082af49447d8a07e3bd95bd0d56f35241523fbab100000000000000000000000089f30783108e2f9191db4a44ae2a516327c995750000000000000000000000000000000000000000000000000000000cce50a84000000000000000000000000000000000000000000000000000000000000000400000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e000000000000000000000000000000000000000000000000000014025e06e400","value":"0x00","to":"0x5E325eDA8064b456f4781070C0738d849c824258"},"blockNumber":"213832225","amount":"22000400000000","amountDecimals":"0.0000220004","quote":"22870878440923","quoteDecimals":"0.000022870878440923","quoteGasAdjusted":"24758565294438","quoteGasAdjustedDecimals":"0.000024758565294438","quoteGasAndPortionAdjusted":"24815742490540","quoteGasAndPortionAdjustedDecimals":"0.00002481574249054","gasUseEstimateQuote":"1887686853515","gasUseEstimateQuoteDecimals":"0.000001887686853515","gasUseEstimate":"190793","gasUseEstimateUSD":"0.007142","simulationStatus":"UNATTEMPTED","simulationError":false,"gasPriceWei":"10000000","route":[[{"type":"v2-pool","address":"0x1504CA3De8F90149520fCb08e27eb57F7D6a7DE6","tokenIn":{"chainId":42161,"decimals":"18","address":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","symbol":"cbETH"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"reserve0":{"token":{"chainId":42161,"decimals":"18","address":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","symbol":"cbETH"},"quotient":"480566368782833"},"reserve1":{"token":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"quotient":"485722144906361"},"amountIn":"2008326802927","amountOut":"2005401000000"}]],"routeString":"[V2] 100.00% = cbETH -- [0x1504CA3De8F90149520fCb08e27eb57F7D6a7DE6] --> WETH","quoteId":"b3852cd8-30cd-4b96-bfbf-74961420bac3","hitsCachedRoutes":true,"portionBips":25,"portionRecipient":"0x89F30783108E2F9191Db4A44aE2A516327C99575","portionAmount":"55001000000","portionAmountDecimals":"0.000000055001","requestId":"22218871-339b-4ca8-860a-8593e90d3b4b","permitData":{"domain":{"name":"Permit2","chainId":42161,"verifyingContract":"0x000000000022D473030F116dDEE9F6B43aC78BA3"},"types":{"PermitSingle":[{"name":"details","type":"PermitDetails"},{"name":"spender","type":"address"},{"name":"sigDeadline","type":"uint256"}],"PermitDetails":[{"name":"token","type":"address"},{"name":"amount","type":"uint160"},{"name":"expiration","type":"uint48"},{"name":"nonce","type":"uint48"}]},"values":{"details":{"token":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","amount":"1461501637330902918203684832716283019655932542975","expiration":"1718963869","nonce":"1"},"spender":"0x5E325eDA8064b456f4781070C0738d849c824258","sigDeadline":"1716373669"}},"tradeType":"EXACT_OUTPUT","slippage":0.5},"requestId":"22218871-339b-4ca8-860a-8593e90d3b4b","allQuotes":[{"routing":"CLASSIC","quote":{"methodParameters":{"calldata":"0x24856bc300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000309050c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000140f2c578c40000000000000000000000000000000000000000000000000000014f50bb466ca00000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f00000000000000000000000082af49447d8a07e3bd95bd0d56f35241523fbab1000000000000000000000000000000000000000000000000000000000000006000000000000000000000000082af49447d8a07e3bd95bd0d56f35241523fbab100000000000000000000000089f30783108e2f9191db4a44ae2a516327c995750000000000000000000000000000000000000000000000000000000cce50a84000000000000000000000000000000000000000000000000000000000000000400000000000000000000000005a91fe74ab3788ff58187acaf3fb0a039534428e000000000000000000000000000000000000000000000000000014025e06e400","value":"0x00","to":"0x5E325eDA8064b456f4781070C0738d849c824258"},"blockNumber":"213832225","amount":"22000400000000","amountDecimals":"0.0000220004","quote":"22870878440923","quoteDecimals":"0.000022870878440923","quoteGasAdjusted":"24758565294438","quoteGasAdjustedDecimals":"0.000024758565294438","quoteGasAndPortionAdjusted":"24815742490540","quoteGasAndPortionAdjustedDecimals":"0.00002481574249054","gasUseEstimateQuote":"1887686853515","gasUseEstimateQuoteDecimals":"0.000001887686853515","gasUseEstimate":"190793","gasUseEstimateUSD":"0.007142","simulationStatus":"UNATTEMPTED","simulationError":false,"gasPriceWei":"10000000","route":[[{"type":"v2-pool","address":"0x1504CA3De8F90149520fCb08e27eb57F7D6a7DE6","tokenIn":{"chainId":42161,"decimals":"18","address":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","symbol":"cbETH"},"tokenOut":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"reserve0":{"token":{"chainId":42161,"decimals":"18","address":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","symbol":"cbETH"},"quotient":"480566368782833"},"reserve1":{"token":{"chainId":42161,"decimals":"18","address":"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1","symbol":"WETH"},"quotient":"485722144906361"},"amountIn":"2008326802927","amountOut":"22055401000000"}]],"routeString":"[V2] 100.00% = cbETH -- [0x1504CA3De8F90149520fCb08e27eb57F7D6a7DE6] --> WETH","quoteId":"b3852cd8-30cd-4b96-bfbf-74961420bac3","hitsCachedRoutes":true,"portionBips":25,"portionRecipient":"0x89F30783108E2F9191Db4A44aE2A516327C99575","portionAmount":"55001000000","portionAmountDecimals":"0.000000055001","requestId":"22218871-339b-4ca8-860a-8593e90d3b4b","permitData":{"domain":{"name":"Permit2","chainId":42161,"verifyingContract":"0x000000000022D473030F116dDEE9F6B43aC78BA3"},"types":{"PermitSingle":[{"name":"details","type":"PermitDetails"},{"name":"spender","type":"address"},{"name":"sigDeadline","type":"uint256"}],"PermitDetails":[{"name":"token","type":"address"},{"name":"amount","type":"uint160"},{"name":"expiration","type":"uint48"},{"name":"nonce","type":"uint48"}]},"values":{"details":{"token":"0x1DEBd73E752bEaF79865Fd6446b0c970EaE7732f","amount":"1461501637330902918203684832716283019655932542975","expiration":"1718963869","nonce":"1"},"spender":"0x5E325eDA8064b456f4781070C0738d849c824258","sigDeadline":"1716373669"}},"tradeType":"EXACT_OUTPUT","slippage":0.5}}]}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // gitleaks:allow
	var (
		quote            utils.Quote
		cbETHquote       utils.Quote
		RING2ETHquote    utils.Quote
		ETH2CBETHV2quote utils.Quote
		CBETH2ETHV2quote utils.Quote
	)
	assert.NoError(t, json.Unmarshal([]byte(quoteData), &quote))
	assert.NoError(t, json.Unmarshal([]byte(cbETHquoteData), &cbETHquote))
	assert.NoError(t, json.Unmarshal([]byte(RING2ETHquoteData), &RING2ETHquote))
	assert.NoError(t, json.Unmarshal([]byte(ETH2CBETHV2quoteData), &ETH2CBETHV2quote))
	assert.NoError(t, json.Unmarshal([]byte(CBETH2ETHV2quoteData), &CBETH2ETHV2quote))
	type fields struct {
		conf configs.Config
	}
	type args struct {
		ctx  context.Context
		args BuildTxParams
	}
	tests := []struct {
		name    string
		fields  fields
		args    args
		want    []byte
		wantErr bool
	}{
		{
			name: "ETH->RING",
			fields: fields{
				conf: *conf,
			},
			args: args{
				args: BuildTxParams{
					TokenIn:  conf.GetTokenInfoOnChain("ETH", "arbitrum"),
					TokenOut: conf.GetTokenInfoOnChain("RING", "arbitrum"),
					Chain:    conf.GetChainConfig("arbitrum"),
					Sender: wallets.NewWallets(wallets.WalletConfig{
						PrivateKey: constant.TestPrivateKey,
						Address:    common.HexToAddress(constant.TestWalletAddress),
					}),
					Quote:    quote,
					Deadline: big.NewInt(1716301989),
					Client:   client,
					Amount:   decimal.RequireFromString("20"),
				},
			},
			wantErr: false,
			// see https://arbiscan.io/tx/0x0f9792ac6ed673eefedee6d773024ac002215295c11ed4a47268e233f1b8889a
			want: common.Hex2Bytes("3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000664cb0a500000000000000000000000000000000000000000000000000000000000000048b01848c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000028000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000014a503087c1300000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000001163fe8c542950000000000000000000000000000000000000000000000000000000014a503087c1300000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b9e523234d36973f9e38642886197d023c88e307e000bb882af49447d8a07e3bd95bd0d56f35241523fbab100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000009e523234d36973f9e38642886197d023c88e307e0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000001158e460913d00000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"),
		},
		{
			name: "RING->CBETH",
			fields: fields{
				conf: *conf,
			},
			args: args{
				args: BuildTxParams{
					TokenIn:  conf.GetTokenInfoOnChain("RING", "arbitrum"),
					TokenOut: conf.GetTokenInfoOnChain("CBETH", "arbitrum"),
					Chain:    conf.GetChainConfig("arbitrum"),
					Sender: wallets.NewWallets(wallets.WalletConfig{
						PrivateKey: constant.TestPrivateKey,
						Address:    common.HexToAddress(constant.TestWalletAddress),
					}),
					Quote:    cbETHquote,
					Deadline: big.NewInt(1716367519),
					Client:   client,
					Amount:   decimal.RequireFromString("0.00002"),
				},
			},
			wantErr: false,
			want:    common.Hex2Bytes("3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000664db09f00000000000000000000000000000000000000000000000000000000000000020184000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000123c4120b4000000000000000000000000000000000000000000000000010eb8b5647007d4b600000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000421debd73e752beaf79865fd6446b0c970eae7732f000bb882af49447d8a07e3bd95bd0d56f35241523fbab1000bb89e523234d36973f9e38642886197d023c88e307e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000012309ce54000"),
		},
		{
			name: "RING->ETH",
			fields: fields{
				conf: *conf,
			},
			args: args{
				args: BuildTxParams{
					TokenIn:  conf.GetTokenInfoOnChain("RING", "arbitrum"),
					TokenOut: conf.GetTokenInfoOnChain("ETH", "arbitrum"),
					Chain:    conf.GetChainConfig("arbitrum"),
					Sender: wallets.NewWallets(wallets.WalletConfig{
						PrivateKey: constant.TestPrivateKey,
						Address:    common.HexToAddress(constant.TestWalletAddress),
					}),
					Quote:    RING2ETHquote,
					Deadline: big.NewInt(1716368349),
					Client:   client,
					Amount:   decimal.RequireFromString("0.00002"),
				},
			},
			wantErr: false,
			want:    common.Hex2Bytes("3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000664db3dd0000000000000000000000000000000000000000000000000000000000000002018c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000123c4120b400000000000000000000000000000000000000000000000000fcce4826bed4f5a700000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002b82af49447d8a07e3bd95bd0d56f35241523fbab1000bb89e523234d36973f9e38642886197d023c88e307e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000012309ce54000"),
		},
		{
			name: "ETH-v2>CBETH",
			fields: fields{
				conf: *conf,
			},
			args: args{
				args: BuildTxParams{
					TokenIn:  conf.GetTokenInfoOnChain("ETH", "arbitrum"),
					TokenOut: conf.GetTokenInfoOnChain("CBETH", "arbitrum"),
					Chain:    conf.GetChainConfig("arbitrum"),
					Sender: wallets.NewWallets(wallets.WalletConfig{
						PrivateKey: constant.TestPrivateKey,
						Address:    common.HexToAddress(constant.TestWalletAddress),
					}),
					Quote:    ETH2CBETHV2quote,
					Deadline: big.NewInt(1716371601),
					Client:   client,
					Amount:   decimal.RequireFromString("0.000002"),
				},
			},
			wantErr: false,
			want:    common.Hex2Bytes("3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000664dc09100000000000000000000000000000000000000000000000000000000000000048b09848c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000028000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000001d9a345f20b00000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000001d2d3501200000000000000000000000000000000000000000000000000000001d9a345f20b00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000082af49447d8a07e3bd95bd0d56f35241523fbab10000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f00000000000000000000000000000000000000000000000000000000000000600000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000001d1a94a2000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"),
		},
		{
			name: "CBETH-v2>ETH",
			fields: fields{
				conf: *conf,
			},
			args: args{
				args: BuildTxParams{
					TokenIn:  conf.GetTokenInfoOnChain("CBETH", "arbitrum"),
					TokenOut: conf.GetTokenInfoOnChain("ETH", "arbitrum"),
					Chain:    conf.GetChainConfig("arbitrum"),
					Sender: wallets.NewWallets(wallets.WalletConfig{
						PrivateKey: constant.TestPrivateKey,
						Address:    common.HexToAddress(constant.TestWalletAddress),
					}),
					Quote:    CBETH2ETHV2quote,
					Deadline: big.NewInt(1716372184),
					Client:   client,
					Amount:   decimal.RequireFromString("0.0000020004"),
				},
			},
			wantErr: false,
			want:    common.Hex2Bytes("3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000664dc2d800000000000000000000000000000000000000000000000000000000000000030a098c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001600000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f0000000000000000000000000000000000000000000000000000299a152b9bb600000000000000000000000000000000000000000000000000000000664f145800000000000000000000000000000000000000000000000000000000000000000000000000000000000000005e325eda8064b456f4781070c0738d849c82425800000000000000000000000000000000000000000000000000000000664f145800000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000004106973fac8dc06d7f7459a4d9c16099e786739b13dcf3506fa3de0330c1582a01400c7fc548e451eecea5aa40229dfc08188073e3e5f5ef32c0871c658cfc0ef31b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000001d2eb36d840000000000000000000000000000000000000000000000000000001d3999b0def00000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000001debd73e752beaf79865fd6446b0c970eae7732f00000000000000000000000082af49447d8a07e3bd95bd0d56f35241523fbab100000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000001d1c121a400"),
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			u := &Uniswap{
				conf: tt.fields.conf,
			}
			got, err := u.BuildTx(tt.args.ctx, tt.args.args)
			if (err != nil) != tt.wantErr {
				t.Errorf("BuildTx() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			assert.Equal(t, common.Bytes2Hex(tt.want), common.Bytes2Hex(got))
		})
	}
}
